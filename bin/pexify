#!/usr/bin/env bash

set -eu
meta=$PWD/recipe/meta.json
build=src/build
(cd src && python -m pip wheel --no-deps --wheel-dir $build .)
args=(
  --output-file uw
  --repo $build
  --scie eager
  --script uw
  uwtools==$(jq -r .version $meta)
  $(jq -r .packages.run[] $meta | grep -v "^python " | sed 's/  *//')
)
pex ${args[*]}
rm -rf $build
