#!/usr/bin/env bash

set -eu
test ! -d recipe && echo "Run from project root directory." && exit 1
build=$PWD/src/build
meta=$PWD/recipe/meta.json
(cd src && python -m pip wheel --no-deps --wheel-dir $build .)
args=(
  --output-file uw
  --repo $build
  --scie eager
  --script uw
  uwtools==$(jq -r .version $meta)
  $(jq -r .packages.run[] $meta | grep -v "^python " | sed 's/  *//')
)
pex ${args[*]}
rm -rf $build
