#!/usr/bin/env bash

set -eu
meta=$PWD/recipe/meta.json
(cd src && set -x && python -m pip wheel --no-deps --wheel-dir build .)
args=(
  --output-file uw
  --repo src/build
  --scie eager
  --script uw
  uwtools==$(jq -r .version $meta)
  $(jq -r .packages.run[] $meta | grep -v "^python " | sed 's/  *//')
)
set -x
pex ${args[*]}
